<% if @rooms.present? %>
  <div class="col-md-6">
    <%= search_form_for @search, class: 'form-group', remote: true, url: host_calendar_path do |f| %>
      <div class="col-md-6 select">
        <div class="form-group">
          <label>Your Listings</label>
          <%= f.select :room_id, options_for_select(@rooms.collect {|u| [u.listing_name, u.id]}, params[:room_id]), {}, {
            onchange: "$(this.form).submit()",
            class: "form-control"
          } %>
        </div>
      </div>

      <%= f.hidden_field :start_date, id: "start-date", value: params[:start_date], onchange: "$(this.form).submit()" %>
    <% end %>
  </div>
<% end %>

<%= render 'form' %>

<div id="calendar"></div>

<div class="col-md-6">
  <div class="pull-right">aa</div>
</div>

<script>
  window.reservations = <%= raw @events.to_json %>

  function showReservations(data) {
    return data.map(function (e) {
      if (e['start_date'] !== e['end_date']) {
        e['end_date'] = moment.utc(e['end_date']).add(1, 'days')
      }

      return {
        name: e.fullname,
        start: e['start_date'],
        end: e['end_date'],
        image: e.image,
        status: e.status
      }
    })
  }

  $('#calendar').fullCalendar({
    header: {
      left: 'title',
      center: '',
      right: 'prev,next'
    }
    defaultDate: $('#start-date').val(),
    //     events: showReservations(reservations),
    // eventRender: function(event, element, view) {
    //   return $(`
    //     <a class="fc-day-grid-event fc-h-event fc-event fc-start fc-end">
    //       <div class="fc-content ${event.status}">
    //         <span class="fc-title"><img class="img-circle avatar-small" src="${event.image}"> ${event.name}</span>
    //       </div>
    //     </a>
    //   `)
    // }
  })


</script>
